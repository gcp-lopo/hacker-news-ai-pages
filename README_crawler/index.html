<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å°è¯´çˆ¬è™«å…¥é—¨æ•™ç¨‹ï¼ˆä»¥ crawl_novel_v4.py ä¸ºä¾‹ï¼‰</title>
  <link rel="stylesheet" href="/hacker-news-ai/assets/css/main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap">
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
</head>
<body>
  <div class="site-container">
    <aside class="site-sidebar">
      
        <nav class="nav-bar">
  <div class="nav-logo">
    <a href="/hacker-news-ai/">ğŸ¤– <span>AIåˆ›ä¸šæ–°é—»</span></a>
  </div>
  
  
  <a href="/hacker-news-ai/archives/" class="archives-btn" style="background: linear-gradient(90deg, #1dd1a1 0%, #3498db 100%); color: #fff; padding: 0.6em 1.3em; border-radius: 8px; font-weight: 600; text-decoration: none; font-size: 1.08rem; box-shadow: 0 2px 8px #1dd1a122; margin-top: 2.5rem; text-align: center; display: block;">å†å²å½’æ¡£</a>
</nav> 
      
    </aside>
    <main class="site-main">
      <article class="post">

  <header class="post-header">
    <h1 class="post-title">å°è¯´çˆ¬è™«å…¥é—¨æ•™ç¨‹ï¼ˆä»¥ crawl_novel_v4.py ä¸ºä¾‹ï¼‰</h1>
  </header>

  <div class="post-content">
    <h1 id="å°è¯´çˆ¬è™«å…¥é—¨æ•™ç¨‹ä»¥-crawl_novel_v4py-ä¸ºä¾‹">å°è¯´çˆ¬è™«å…¥é—¨æ•™ç¨‹ï¼ˆä»¥ crawl_novel_v4.py ä¸ºä¾‹ï¼‰</h1>

<h2 id="1-ä»€ä¹ˆæ˜¯çˆ¬è™«">1. ä»€ä¹ˆæ˜¯çˆ¬è™«ï¼Ÿ</h2>

<p>çˆ¬è™«ï¼ˆWeb Crawlerï¼‰æ˜¯ä¸€ç§è‡ªåŠ¨åŒ–ç¨‹åºï¼Œç”¨äºæ¨¡æ‹Ÿäººå·¥æµè§ˆç½‘é¡µã€æ‰¹é‡æŠ“å–ç½‘é¡µä¸Šçš„æ•°æ®ã€‚å°è¯´çˆ¬è™«å°±æ˜¯è‡ªåŠ¨åŒ–ä¸‹è½½å°è¯´ç½‘ç«™ä¸Šçš„ç« èŠ‚å†…å®¹ï¼Œæ•´ç†æˆæœ¬åœ°æ–‡ä»¶ã€‚</p>

<hr />

<h2 id="2-ç¯å¢ƒå‡†å¤‡">2. ç¯å¢ƒå‡†å¤‡</h2>

<ul>
  <li><strong>Python ç‰ˆæœ¬</strong>ï¼šæ¨è 3.7 åŠä»¥ä¸Š</li>
  <li><strong>ä¾èµ–åº“</strong>ï¼š
    <ul>
      <li>requestsï¼ˆç½‘ç»œè¯·æ±‚ï¼‰</li>
      <li>beautifulsoup4ï¼ˆç½‘é¡µè§£æï¼‰</li>
      <li>lxmlï¼ˆåŠ é€Ÿè§£æï¼Œå¯é€‰ï¼‰</li>
      <li>reï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œå†…ç½®ï¼‰</li>
      <li>timeã€osã€jsonï¼ˆå†…ç½®ï¼‰</li>
    </ul>
  </li>
</ul>

<p>å®‰è£…ä¾èµ–ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>requests beautifulsoup4 lxml
</code></pre></div></div>

<hr />

<h2 id="3-ç½‘ç«™åˆ†æ">3. ç½‘ç«™åˆ†æ</h2>

<ol>
  <li><strong>ç›®æ ‡ç½‘ç«™</strong>ï¼šä»¥ <code class="language-plaintext highlighter-rouge">https://www.kanshudashi.com</code> ä¸ºä¾‹ã€‚</li>
  <li><strong>åˆ†æç« èŠ‚åˆ—è¡¨é¡µ</strong>ï¼šæ‰¾åˆ°æ‰€æœ‰ç« èŠ‚çš„é“¾æ¥ï¼ˆé€šå¸¸åœ¨ç›®å½•é¡µï¼‰ã€‚</li>
  <li><strong>åˆ†æç« èŠ‚å†…å®¹é¡µ</strong>ï¼šç¡®å®šæ­£æ–‡å†…å®¹å’Œæ ‡é¢˜çš„ HTML æ ‡ç­¾ã€‚</li>
</ol>

<blockquote>
  <p>å°æŠ€å·§ï¼šæŒ‰ F12 æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ŒæŸ¥çœ‹ç½‘é¡µç»“æ„ã€‚</p>
</blockquote>

<hr />

<h2 id="4-ä»£ç ç»“æ„ä¸æ ¸å¿ƒæµç¨‹">4. ä»£ç ç»“æ„ä¸æ ¸å¿ƒæµç¨‹</h2>

<h3 id="41-ç±»çš„è®¾è®¡">4.1 ç±»çš„è®¾è®¡</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">NovelCrawlerV4</code> ç±»ï¼šè´Ÿè´£æ‰€æœ‰çˆ¬è™«é€»è¾‘ã€‚</li>
  <li>ä¸»è¦æ–¹æ³•ï¼š
    <ul>
      <li><code class="language-plaintext highlighter-rouge">get_all_chapter_links()</code>ï¼šè·å–æ‰€æœ‰ç« èŠ‚é“¾æ¥</li>
      <li><code class="language-plaintext highlighter-rouge">get_chapter_content(url)</code>ï¼šè·å–å•ç« å†…å®¹</li>
      <li><code class="language-plaintext highlighter-rouge">crawl_novel()</code>ï¼šä¸»æµç¨‹ï¼Œå¾ªç¯çˆ¬å–æ‰€æœ‰ç« èŠ‚</li>
      <li><code class="language-plaintext highlighter-rouge">load_progress()</code>/<code class="language-plaintext highlighter-rouge">save_progress()</code>ï¼šæ–­ç‚¹ç»­çˆ¬</li>
    </ul>
  </li>
</ul>

<h3 id="42-ä¸»è¦æµç¨‹">4.2 ä¸»è¦æµç¨‹</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">crawler</span> <span class="o">=</span> <span class="n">NovelCrawlerV4</span><span class="p">()</span>
<span class="n">crawler</span><span class="p">.</span><span class="n">crawl_novel</span><span class="p">()</span>
</code></pre></div></div>

<ol>
  <li><strong>è·å–ç« èŠ‚åˆ—è¡¨</strong>
    <ul>
      <li>è®¿é—®å°è¯´ç›®å½•é¡µï¼Œè§£ææ‰€æœ‰ç« èŠ‚çš„é“¾æ¥å’Œæ ‡é¢˜ã€‚</li>
    </ul>
  </li>
  <li><strong>å¾ªç¯çˆ¬å–æ¯ä¸€ç« </strong>
    <ul>
      <li>ä¾æ¬¡è®¿é—®æ¯ä¸ªç« èŠ‚é“¾æ¥ï¼Œæå–æ ‡é¢˜å’Œæ­£æ–‡ã€‚</li>
      <li>ä¿å­˜åˆ°æœ¬åœ° txt æ–‡ä»¶ã€‚</li>
      <li>æ¯çˆ¬å®Œä¸€ç« ï¼Œè®°å½•è¿›åº¦ï¼Œæ”¯æŒæ–­ç‚¹ç»­çˆ¬ã€‚</li>
    </ul>
  </li>
  <li><strong>å¼‚å¸¸å¤„ç†</strong>
    <ul>
      <li>ç½‘ç»œè¶…æ—¶ã€å†…å®¹ç¼ºå¤±ç­‰ä¼šè‡ªåŠ¨è·³è¿‡å¹¶è®°å½•ã€‚</li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="5-å…³é”®ä»£ç è®²è§£">5. å…³é”®ä»£ç è®²è§£</h2>

<h3 id="51-è·å–ç« èŠ‚é“¾æ¥">5.1 è·å–ç« èŠ‚é“¾æ¥</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">novel_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">,</span> <span class="s">'html.parser'</span><span class="p">)</span>
<span class="n">links</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">'a'</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="n">re</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="sa">r</span><span class="s">'/book/hbwlll-\\d+\\.html'</span><span class="p">))</span>
</code></pre></div></div>
<ul>
  <li>ç”¨æ­£åˆ™åŒ¹é…æ‰€æœ‰ç« èŠ‚çš„é“¾æ¥ã€‚</li>
</ul>

<h3 id="52-è·å–ç« èŠ‚å†…å®¹">5.2 è·å–ç« èŠ‚å†…å®¹</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">chapter_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">,</span> <span class="s">'html.parser'</span><span class="p">)</span>
<span class="n">content_div</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">select_one</span><span class="p">(</span><span class="s">'div.content'</span><span class="p">)</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">content_div</span><span class="p">.</span><span class="n">get_text</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
</code></pre></div></div>
<ul>
  <li>é€‰æ‹©åˆé€‚çš„æ ‡ç­¾æå–æ­£æ–‡ã€‚</li>
</ul>

<h3 id="53-æ–­ç‚¹ç»­çˆ¬">5.3 æ–­ç‚¹ç»­çˆ¬</h3>
<ul>
  <li>æ¯çˆ¬å®Œä¸€ç« ï¼Œä¿å­˜å·²å®Œæˆçš„ç« èŠ‚åˆ° json æ–‡ä»¶ã€‚</li>
  <li>ä¸‹æ¬¡è¿è¡Œæ—¶è‡ªåŠ¨è·³è¿‡å·²å®Œæˆéƒ¨åˆ†ã€‚</li>
</ul>

<hr />

<h2 id="6-åçˆ¬è™«æœºåˆ¶ä¸åº”å¯¹">6. åçˆ¬è™«æœºåˆ¶ä¸åº”å¯¹</h2>

<ul>
  <li><strong>User-Agent</strong>ï¼šæ¨¡æ‹Ÿæµè§ˆå™¨è®¿é—®ã€‚</li>
  <li><strong>å»¶è¿Ÿè¯·æ±‚</strong>ï¼š<code class="language-plaintext highlighter-rouge">time.sleep(1)</code>ï¼Œé˜²æ­¢è®¿é—®è¿‡å¿«è¢«å°ã€‚</li>
  <li><strong>å¼‚å¸¸å¤„ç†</strong>ï¼šæ•è·ç½‘ç»œé”™è¯¯ï¼Œè‡ªåŠ¨é‡è¯•æˆ–è·³è¿‡ã€‚</li>
</ul>

<hr />

<h2 id="7-å¸¸è§æŠ¥é”™ä¸æ’æŸ¥">7. å¸¸è§æŠ¥é”™ä¸æ’æŸ¥</h2>

<ul>
  <li><strong>ç½‘ç»œè¶…æ—¶</strong>ï¼šæ£€æŸ¥ç½‘ç»œï¼Œé€‚å½“åŠ å¤§è¶…æ—¶æ—¶é—´ã€‚</li>
  <li><strong>å†…å®¹æå–ä¸åˆ°</strong>ï¼šæ£€æŸ¥ç½‘é¡µç»“æ„æ˜¯å¦å˜åŒ–ï¼Œè°ƒæ•´é€‰æ‹©å™¨ã€‚</li>
  <li><strong>ç¼–ç é—®é¢˜</strong>ï¼šç»Ÿä¸€ç”¨ <code class="language-plaintext highlighter-rouge">utf-8</code> è¯»å†™æ–‡ä»¶ã€‚</li>
</ul>

<hr />

<h2 id="8-å°ç™½å†™çˆ¬è™«çš„å»ºè®®">8. å°ç™½å†™çˆ¬è™«çš„å»ºè®®</h2>

<ol>
  <li>å…ˆç”¨æµè§ˆå™¨åˆ†æç›®æ ‡ç½‘é¡µç»“æ„ã€‚</li>
  <li>ç”¨ requests+BeautifulSoup å…ˆæŠ“ä¸€é¡µï¼Œè°ƒè¯•æå–å†…å®¹ã€‚</li>
  <li>å†æ‰¹é‡æŠ“å–ï¼Œæ³¨æ„åŠ å»¶è¿Ÿã€‚</li>
  <li>å¤„ç†å¼‚å¸¸ï¼Œä¿è¯è„šæœ¬å¥å£®ã€‚</li>
  <li>å°Šé‡ç½‘ç«™ robots åè®®å’Œç‰ˆæƒã€‚</li>
</ol>

<hr />

<h2 id="9-å‚è€ƒèµ„æ–™">9. å‚è€ƒèµ„æ–™</h2>
<ul>
  <li><a href="https://docs.python-requests.org/zh_CN/latest/">requests å®˜æ–¹æ–‡æ¡£</a></li>
  <li><a href="https://beautifulsoup.readthedocs.io/zh_CN/latest/">BeautifulSoup4 æ–‡æ¡£</a></li>
  <li><a href="https://docs.python.org/zh-cn/3/library/re.html">Python æ­£åˆ™è¡¨è¾¾å¼</a></li>
</ul>

<hr />

<p>å¦‚æœ‰ç–‘é—®ï¼Œæ¬¢è¿æé—®ï¼</p>

<hr />

<h2 id="10-crawl_novel_v4py-ä»£ç é€è¡Œè®²è§£">10. crawl_novel_v4.py ä»£ç é€è¡Œè®²è§£</h2>

<p>ä¸‹é¢ä»¥ä¸»è¦ç»“æ„å’Œå…³é”®å‡½æ•°ä¸ºä¾‹ï¼Œé€è¡Œè¯¦ç»†æ³¨é‡Šè¯´æ˜ï¼š</p>

<h3 id="101-å¯¼å…¥ä¾èµ–">10.1 å¯¼å…¥ä¾èµ–</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>  <span class="c1"># ç”¨äºå‘é€ç½‘ç»œè¯·æ±‚
</span><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">Tag</span>  <span class="c1"># ç½‘é¡µè§£æåº“
</span><span class="kn">import</span> <span class="nn">time</span>  <span class="c1"># æ§åˆ¶è¯·æ±‚é—´éš”ï¼Œé˜²æ­¢è¢«å°
</span><span class="kn">import</span> <span class="nn">re</span>  <span class="c1"># æ­£åˆ™è¡¨è¾¾å¼ï¼Œæå–é“¾æ¥å’Œå†…å®¹
</span><span class="kn">import</span> <span class="nn">os</span>  <span class="c1"># æ–‡ä»¶å’Œè·¯å¾„æ“ä½œ
</span><span class="kn">import</span> <span class="nn">json</span>  <span class="c1"># è¿›åº¦ä¿å­˜ä¸ºjson
</span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>  <span class="c1"># ç±»å‹æç¤º
</span></code></pre></div></div>

<h3 id="102-çˆ¬è™«ç±»åˆå§‹åŒ–">10.2 çˆ¬è™«ç±»åˆå§‹åŒ–</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">NovelCrawlerV4</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="s">"https://www.kanshudashi.com"</span>  <span class="c1"># ç½‘ç«™ä¸»åŸŸå
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">novel_url</span> <span class="o">=</span> <span class="s">"https://www.kanshudashi.com/book/hbwlll.html"</span>  <span class="c1"># å°è¯´ç›®å½•é¡µ
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'User-Agent'</span><span class="p">:</span> <span class="s">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'</span>
        <span class="p">}</span>  <span class="c1"># ä¼ªè£…æˆæµè§ˆå™¨ï¼Œé˜²æ­¢è¢«å°
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span>  <span class="c1"># ä¼šè¯å¯¹è±¡ï¼Œè‡ªåŠ¨ç®¡ç†cookie
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">headers</span><span class="p">)</span>  <span class="c1"># è®¾ç½®è¯·æ±‚å¤´
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">progress_file</span> <span class="o">=</span> <span class="s">"crawl_progress_v4.json"</span>  <span class="c1"># è¿›åº¦ä¿å­˜æ–‡ä»¶
</span></code></pre></div></div>

<h3 id="103-è¿›åº¦åŠ è½½ä¸ä¿å­˜">10.3 è¿›åº¦åŠ è½½ä¸ä¿å­˜</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">load_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""åŠ è½½çˆ¬å–è¿›åº¦"""</span>
        <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">progress_file</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">progress_file</span><span class="p">,</span> <span class="s">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>  <span class="c1"># è¯»å–å·²å®Œæˆç« èŠ‚
</span>            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s">"completed_chapters"</span><span class="p">:</span> <span class="p">[],</span> <span class="s">"failed_chapters"</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"completed_chapters"</span><span class="p">:</span> <span class="p">[],</span> <span class="s">"failed_chapters"</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="k">def</span> <span class="nf">save_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">progress</span><span class="p">):</span>
        <span class="s">"""ä¿å­˜çˆ¬å–è¿›åº¦"""</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">progress_file</span><span class="p">,</span> <span class="s">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># ä¿å­˜ä¸ºjson
</span></code></pre></div></div>

<h3 id="104-æ£€æŸ¥ç« èŠ‚urlæ˜¯å¦å­˜åœ¨">10.4 æ£€æŸ¥ç« èŠ‚URLæ˜¯å¦å­˜åœ¨</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">test_chapter_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chapter_num</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"https://www.kanshudashi.com/book/hbwlll-</span><span class="si">{</span><span class="n">chapter_num</span><span class="si">}</span><span class="s">.html"</span>  <span class="c1"># æ‹¼æ¥ç« èŠ‚é“¾æ¥
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">,</span> <span class="s">'html.parser'</span><span class="p">)</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">get_text</span><span class="p">()</span>
                <span class="c1"># åˆ¤æ–­é¡µé¢å†…å®¹æ˜¯å¦åƒå°è¯´æ­£æ–‡
</span>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="ow">and</span> <span class="p">(</span><span class="s">'è¿™æ˜¯æˆ‘'</span> <span class="ow">in</span> <span class="n">content</span> <span class="ow">or</span> <span class="s">'å¸ˆçˆ¶'</span> <span class="ow">in</span> <span class="n">content</span> <span class="ow">or</span> <span class="s">'æ–½ä¸»'</span> <span class="ow">in</span> <span class="n">content</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">True</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
</code></pre></div></div>

<h3 id="105-è·å–ç« èŠ‚æ ‡é¢˜">10.5 è·å–ç« èŠ‚æ ‡é¢˜</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">get_chapter_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chapter_num</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"https://www.kanshudashi.com/book/hbwlll-</span><span class="si">{</span><span class="n">chapter_num</span><span class="si">}</span><span class="s">.html"</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">,</span> <span class="s">'html.parser'</span><span class="p">)</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'h1'</span><span class="p">)</span> <span class="ow">or</span> <span class="n">soup</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'h2'</span><span class="p">)</span> <span class="ow">or</span> <span class="n">soup</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'div'</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">'chapter-title'</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">title</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s">"ç¬¬</span><span class="si">{</span><span class="n">chapter_num</span><span class="si">}</span><span class="s">ç« "</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s">"ç¬¬</span><span class="si">{</span><span class="n">chapter_num</span><span class="si">}</span><span class="s">ç« "</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s">"ç¬¬</span><span class="si">{</span><span class="n">chapter_num</span><span class="si">}</span><span class="s">ç« "</span>
</code></pre></div></div>

<h3 id="106-è·å–æ‰€æœ‰ç« èŠ‚é“¾æ¥">10.6 è·å–æ‰€æœ‰ç« èŠ‚é“¾æ¥</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">get_all_chapter_links</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">all_chapters</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># å­˜å‚¨æ‰€æœ‰ç« èŠ‚
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># æ–¹å¼1ï¼šä»ç›®å½•é¡µæå–
</span>            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">novel_url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">,</span> <span class="s">'html.parser'</span><span class="p">)</span>
            <span class="n">chapters</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">extract_chapters_from_page</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">chapters</span><span class="p">:</span>
                <span class="n">all_chapters</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="n">chapters</span><span class="p">)</span>
            <span class="c1"># æ–¹å¼2ï¼šéå†æ‰€æœ‰å¯èƒ½çš„ç« èŠ‚å·ï¼Œæµ‹è¯•æ˜¯å¦å­˜åœ¨
</span>            <span class="n">test_ranges</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">...</span> <span class="p">]</span>  <span class="c1"># ç« èŠ‚å·åˆ†æ®µ
</span>            <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">test_ranges</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">test_chapter_url</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_chapter_title</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="n">all_chapters</span><span class="p">.</span><span class="n">append</span><span class="p">({</span><span class="s">'title'</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span> <span class="s">'url'</span><span class="p">:</span> <span class="sa">f</span><span class="s">"https://www.kanshudashi.com/book/hbwlll-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">.html"</span><span class="p">})</span>
                    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># é˜²æ­¢è¯·æ±‚è¿‡å¿«
</span>            <span class="c1"># å»é‡ã€æ’åº
</span>            <span class="p">...</span>
            <span class="k">return</span> <span class="n">unique_chapters</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"è·å–ç« èŠ‚åˆ—è¡¨å¤±è´¥: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></div>

<h3 id="107-æå–ç« èŠ‚é“¾æ¥è¾…åŠ©å‡½æ•°">10.7 æå–ç« èŠ‚é“¾æ¥ï¼ˆè¾…åŠ©å‡½æ•°ï¼‰</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">extract_chapters_from_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">soup</span><span class="p">):</span>
        <span class="n">chapters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_links</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">'a'</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">all_links</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">Tag</span><span class="p">):</span>
                <span class="n">href</span> <span class="o">=</span> <span class="n">link</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'href'</span><span class="p">)</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">link</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">href</span> <span class="ow">and</span> <span class="n">text</span> <span class="ow">and</span> <span class="n">re</span><span class="p">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s">'/book/hbwlll-\d+\.html'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">href</span><span class="p">)):</span>
                    <span class="n">chapters</span><span class="p">.</span><span class="n">append</span><span class="p">({</span><span class="s">'title'</span><span class="p">:</span> <span class="n">text</span><span class="p">,</span> <span class="s">'url'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">base_url</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">href</span><span class="p">)})</span>
        <span class="k">return</span> <span class="n">chapters</span>
</code></pre></div></div>

<h3 id="108-è·å–ç« èŠ‚å†…å®¹">10.8 è·å–ç« èŠ‚å†…å®¹</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">get_chapter_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chapter_url</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">chapter_url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">,</span> <span class="s">'html.parser'</span><span class="p">)</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'h1'</span><span class="p">)</span> <span class="ow">or</span> <span class="n">soup</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'h2'</span><span class="p">)</span> <span class="ow">or</span> <span class="n">soup</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'div'</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">'chapter-title'</span><span class="p">)</span>
            <span class="n">title_text</span> <span class="o">=</span> <span class="n">title</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">title</span> <span class="k">else</span> <span class="s">"æœªçŸ¥ç« èŠ‚"</span>
            <span class="c1"># å¤šç§é€‰æ‹©å™¨å°è¯•æ­£æ–‡div
</span>            <span class="n">selectors</span> <span class="o">=</span> <span class="p">[</span> <span class="s">'div.content'</span><span class="p">,</span> <span class="s">'div#content'</span><span class="p">,</span> <span class="p">...</span> <span class="p">]</span>
            <span class="k">for</span> <span class="n">selector</span> <span class="ow">in</span> <span class="n">selectors</span><span class="p">:</span>
                <span class="n">content_div</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">select_one</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">content_div</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">content_div</span><span class="p">:</span>
                <span class="c1"># å…œåº•ï¼šæ‰¾åŒ…å«å¤§é‡æ–‡æœ¬çš„div
</span>                <span class="p">...</span>
            <span class="k">if</span> <span class="n">content_div</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">content_div</span><span class="p">.</span><span class="n">get_text</span><span class="p">()</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s">'\s+'</span><span class="p">,</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="n">content</span><span class="p">).</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">title_text</span><span class="p">,</span> <span class="n">content</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">title_text</span><span class="p">,</span> <span class="s">"å†…å®¹è·å–å¤±è´¥"</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"è·å–ç« èŠ‚å†…å®¹å¤±è´¥: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">"è·å–å¤±è´¥"</span><span class="p">,</span> <span class="sa">f</span><span class="s">"é”™è¯¯: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span>
</code></pre></div></div>

<h3 id="109-ä¸»æµç¨‹çˆ¬å–æ•´æœ¬å°è¯´">10.9 ä¸»æµç¨‹ï¼šçˆ¬å–æ•´æœ¬å°è¯´</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">crawl_novel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_chapters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"å¼€å§‹çˆ¬å–ã€Šå¤©çœ¼é£æ°´å¸ˆã€‹å®Œæ•´ç‰ˆ..."</span><span class="p">)</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">load_progress</span><span class="p">()</span> <span class="k">if</span> <span class="n">resume</span> <span class="k">else</span> <span class="p">{</span><span class="s">"completed_chapters"</span><span class="p">:</span> <span class="p">[],</span> <span class="s">"failed_chapters"</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="n">completed_urls</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">progress</span><span class="p">[</span><span class="s">"completed_chapters"</span><span class="p">])</span>
        <span class="n">chapters</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_all_chapter_links</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">chapters</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"æœªæ‰¾åˆ°ç« èŠ‚åˆ—è¡¨"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">resume</span><span class="p">:</span>
            <span class="n">chapters</span> <span class="o">=</span> <span class="p">[</span><span class="n">ch</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">chapters</span> <span class="k">if</span> <span class="n">ch</span><span class="p">[</span><span class="s">'url'</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">completed_urls</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">max_chapters</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">chapters</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_chapters</span><span class="p">:</span>
            <span class="n">chapters</span> <span class="o">=</span> <span class="n">chapters</span><span class="p">[:</span><span class="n">max_chapters</span><span class="p">]</span>
        <span class="n">novel_content</span> <span class="o">=</span> <span class="p">[</span><span class="s">"ã€Šå¤©çœ¼é£æ°´å¸ˆã€‹"</span><span class="p">,</span> <span class="p">...]</span>  <span class="c1"># å°è¯´å…ƒä¿¡æ¯
</span>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chapter</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chapters</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"æ­£åœ¨çˆ¬å–ç¬¬ </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chapters</span><span class="p">)</span><span class="si">}</span><span class="s"> ç« : </span><span class="si">{</span><span class="n">chapter</span><span class="p">[</span><span class="s">'title'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="n">title</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_chapter_content</span><span class="p">(</span><span class="n">chapter</span><span class="p">[</span><span class="s">'url'</span><span class="p">])</span>
            <span class="k">if</span> <span class="s">"è·å–å¤±è´¥"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">title</span> <span class="ow">and</span> <span class="s">"å†…å®¹è·å–å¤±è´¥"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
                <span class="n">novel_content</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="se">\n</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="n">novel_content</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">"-"</span> <span class="o">*</span> <span class="mi">30</span><span class="p">)</span>
                <span class="n">novel_content</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
                <span class="n">novel_content</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span> <span class="o">+</span> <span class="s">"="</span> <span class="o">*</span> <span class="mi">50</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
                <span class="n">progress</span><span class="p">[</span><span class="s">"completed_chapters"</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">chapter</span><span class="p">[</span><span class="s">'url'</span><span class="p">])</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">save_progress</span><span class="p">(</span><span class="n">progress</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"ç« èŠ‚ </span><span class="si">{</span><span class="n">chapter</span><span class="p">[</span><span class="s">'title'</span><span class="p">]</span><span class="si">}</span><span class="s"> çˆ¬å–å¤±è´¥"</span><span class="p">)</span>
                <span class="n">progress</span><span class="p">[</span><span class="s">"failed_chapters"</span><span class="p">].</span><span class="n">append</span><span class="p">({</span><span class="s">"title"</span><span class="p">:</span> <span class="n">chapter</span><span class="p">[</span><span class="s">'title'</span><span class="p">],</span> <span class="s">"url"</span><span class="p">:</span> <span class="n">chapter</span><span class="p">[</span><span class="s">'url'</span><span class="p">],</span> <span class="s">"error"</span><span class="p">:</span> <span class="n">content</span><span class="p">})</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">save_progress</span><span class="p">(</span><span class="n">progress</span><span class="p">)</span>
            <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s">"å¤©çœ¼é£æ°´å¸ˆ_å®Œæ•´ç‰ˆ_v4.txt"</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">novel_content</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="se">\n</span><span class="s">çˆ¬å–å®Œæˆï¼å°è¯´å·²ä¿å­˜ä¸º: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"æˆåŠŸçˆ¬å–: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">progress</span><span class="p">[</span><span class="s">'completed_chapters'</span><span class="p">])</span><span class="si">}</span><span class="s"> ç« "</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"å¤±è´¥ç« èŠ‚: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">progress</span><span class="p">[</span><span class="s">'failed_chapters'</span><span class="p">])</span><span class="si">}</span><span class="s"> ç« "</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filename</span>
</code></pre></div></div>

<h3 id="1010-ç¨‹åºå…¥å£">10.10 ç¨‹åºå…¥å£</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">crawler</span> <span class="o">=</span> <span class="n">NovelCrawlerV4</span><span class="p">()</span>
    <span class="n">crawler</span><span class="p">.</span><span class="n">crawl_novel</span><span class="p">(</span><span class="n">max_chapters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<blockquote>
  <p>ä»¥ä¸Šä¸º crawl_novel_v4.py çš„ä¸»è¦ç»“æ„å’Œå…³é”®å‡½æ•°é€è¡Œè®²è§£ã€‚å»ºè®®æ–°æ‰‹ç»“åˆå®é™…ä»£ç å’Œæ³¨é‡Šå¤šè°ƒè¯•ã€å¤šå°è¯•ï¼Œé‡åˆ°é—®é¢˜å¤šæŸ¥æ–‡æ¡£å’ŒæŠ¥é”™ä¿¡æ¯ã€‚</p>
</blockquote>

  </div>

</article>

    </main>
  </div>
  <script src="/hacker-news-ai/assets/js/main.js"></script>
</body>
</html> 